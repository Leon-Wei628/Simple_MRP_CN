# 物料需求计划(MRP)系统

这是一个基于Streamlit和OR-Tools的物料需求计划(MRP)系统，用于计算和优化物料需求。

## 功能特点

- 上传并处理生产计划、BOM、库存和采购订单数据
- 支持多层级BOM结构的物料需求计算
- 使用OR-Tools进行优化计算
- 考虑当前库存、安全库存和在途采购订单
- 提供可视化的物料需求结果
- 支持结果导出为CSV文件

## 安装依赖

```bash
pip install streamlit pandas numpy ortools
```

## 运行应用

```bash
streamlit run app.py
```

## 使用方法

1. 在侧边栏上传必要的CSV文件：
   - 生产计划
   - BOM数据
   - 库存数据
   - 采购订单数据（可选）

2. 点击"计算物料需求"按钮

3. 在"MRP结果"标签页查看计算结果和可视化图表

4. 可以下载结果为CSV文件

## 数据格式要求

### 1. 生产计划 (production_plan.csv)

必须包含以下列：
- 产品编码：最终产品的唯一标识符
- 需求数量：需要生产的数量
- 需求日期：需要完成生产的日期

示例：
```
产品编码,产品名称,需求数量,需求日期
P001,最终产品A,100,2023-06-01
P001,最终产品A,150,2023-06-15
```

### 2. BOM数据 (bom_data.csv)

必须包含以下列：
- 父项编码：父物料的唯一标识符
- 子项编码：子物料的唯一标识符
- 用量：每单位父物料需要的子物料数量

示例：
```
父项编码,父项名称,子项编码,子项名称,用量,单位
P001,最终产品A,C001,组件1,2,个
C001,组件1,M001,原材料1,3,kg
```

### 3. 库存数据 (inventory_data.csv)

必须包含以下列：
- 物料编码：物料的唯一标识符
- 库存数量：当前库存量
- 安全库存：最低安全库存量

示例：
```
物料编码,物料名称,库存数量,安全库存,单位
P001,最终产品A,20,10,个
C001,组件1,50,20,个
```

### 4. 采购订单数据 (purchase_orders.csv) - 可选

如果提供，必须包含以下列：
- 物料编码：物料的唯一标识符
- 订单数量：采购的数量
- 预计到货日期：预计物料到达的日期

示例：
```
订单编号,物料编码,物料名称,订单数量,单位,订单日期,预计到货日期,供应商
PO001,M001,原材料1,50,kg,2023-05-15,2023-05-30,供应商A
```

## 示例数据

在`sample_data`目录中提供了示例数据文件，可以用于测试系统：

- `production_plan.csv`：生产计划示例
- `bom_data.csv`：BOM数据示例
- `inventory_data.csv`：库存数据示例
- `purchase_orders.csv`：采购订单示例

## 系统逻辑

1. **数据预处理**：验证上传的数据格式和必要字段

2. **BOM展开**：构建多层级物料清单树结构

3. **总需求计算**：基于生产计划和BOM结构计算各物料的总需求

4. **净需求计算**：考虑当前库存、安全库存和采购订单，使用OR-Tools优化计算净需求

5. **结果生成**：生成包含物料编码、需求周期、总需求量、净需求量等信息的结果

## 扩展和自定义

可以通过修改代码来扩展系统功能，例如：

- 添加更复杂的优化约束条件
- 考虑生产提前期和采购提前期
- 添加批量生产和批量采购的约束
- 集成供应商管理和成本优化
- 添加更多可视化图表和分析功能